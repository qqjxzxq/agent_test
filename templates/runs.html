<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å†å²è®°å½• - æ”¿åºœéƒ¨é—¨å¤šæ™ºèƒ½ä½“å†³ç­–ä»¿çœŸç³»ç»Ÿ</title>
  <link rel="stylesheet" href="/static/style.css">
</head>

<body>
  {% set status_map = {
  "pending": "å¾…å¤„ç†",
  "running": "è¿è¡Œä¸­",
  "completed": "å·²å®Œæˆ",
  "failed": "å¤±è´¥"
  } %}
  {% set stage_map = {
  "intake_issue": "è®®é¢˜è¿›å…¥",
  "departments_generate_memos": "éƒ¨é—¨å¤‡å¿˜å½•",
  "secretariat_aggregate_disputes": "æ±‡æ€»åˆ†æ­§",
  "negotiation_rounds": "å¤šè½®è°ˆåˆ¤",
  "legal_review_gate": "æ³•åˆ¶é—¨ç¦",
  "fiscal_capacity_review_gate": "è´¢æ”¿é—¨ç¦",
  "workflow": "å·¥ä½œæµ",
  "decider_finalize": "æœ€ç»ˆè£å†³",
  "implementation_plan": "æ‰§è¡Œè®¡åˆ’"
  } %}

  <div class="container">
    <header>
      <h1>ğŸ›ï¸ æ”¿åºœéƒ¨é—¨å¤šæ™ºèƒ½ä½“å†³ç­–ä»¿çœŸç³»ç»Ÿ</h1>
      <nav>
        <a href="/">æ–°å»ºä»¿çœŸ</a>
        <a href="/runs" class="active">å†å²è®°å½•</a>
        <a href="/setup">âš™ï¸ API é…ç½®</a>
      </nav>
    </header>

    <main>
      <section class="runs-list">
        <h2>å†å²ä»¿çœŸè®°å½•</h2>

        {% if runs %}
        <table class="runs-table">
          <thead>
            <tr>
              <th>Run ID</th>
              <th>è®®é¢˜</th>
              <th>çŠ¶æ€</th>
              <th>å½“å‰é˜¶æ®µ</th>
              <th>åˆ›å»ºæ—¶é—´</th>
              <th>æ“ä½œ</th>
            </tr>
          </thead>
          <tbody>
            {% for run in runs %}
            <tr>
              <td><code>{{ run.run_id[:8] }}</code></td>
              <td>{{ run.issue_title }}</td>
              <td>
                <span class="status-badge status-{{ run.status }}">
                  {{ status_map.get(run.status, run.status) }}
                </span>
              </td>
              <td>{{ stage_map.get(run.current_stage, run.current_stage) }}</td>
              <td>{{ run.created_at[:19] }}</td>
              <td>
                <a href="/runs/{{ run.run_id }}" class="btn-link">æŸ¥çœ‹</a>
                <button onclick="deleteRun('{{ run.run_id }}', '{{ run.issue_title }}')" class="btn-delete">åˆ é™¤</button>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
        {% else %}
        <div class="empty-state">
          <p>ğŸ“­ æš‚æ— å†å²è®°å½•</p>
          <a href="/" class="btn-primary">åˆ›å»ºç¬¬ä¸€ä¸ªä»¿çœŸ</a>
        </div>
        {% endif %}
      </section>
    </main>
  </div>

  <script>
    async function deleteRun(runId, issueTitle) {
      if (!confirm(`ç¡®å®šè¦åˆ é™¤è¿è¡Œè®°å½•ã€Œ${issueTitle}ã€å—ï¼Ÿ\n\nRun ID: ${runId.substring(0, 8)}\n\næ­¤æ“ä½œä¸å¯æ¢å¤ï¼`)) {
        return;
      }

      try {
        const response = await fetch(`/api/runs/${runId}`, {
          method: 'DELETE'
        });

        if (response.ok) {
          alert('åˆ é™¤æˆåŠŸ');
          location.reload();
        } else {
          const error = await response.text();
          alert('åˆ é™¤å¤±è´¥ï¼š' + error);
        }
      } catch (error) {
        alert('åˆ é™¤å¤±è´¥ï¼š' + error.message);
      }
    }
  </script>
</body>

</html>